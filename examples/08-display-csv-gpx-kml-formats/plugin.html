<plugin>
	<div class="plugin-content">

		Using excellent <b>Leaflet Omnivore</b>
    we can display whichever format we want.

		<ul data-ref="links"></ul>

	</div>
	<script>

	import map from '@windy/map'

	let layer = null

  const formats = 'csv,gpx,kml,polyline,topojson,wkt'.split(',')

  formats.forEach( f => {
    const el = document.createElement('li')
    el.className = 'clickable-size'
    el.onclick = loadFile.bind(this,f)
    el.textContent = `Display ${ f.toUpperCase() }`
    this.refs.links.appendChild(el)
  })

	this.onclose = () => removeFile()

	function loadFile(f) {

    removeFile()

    const url = `https://gist.githubusercontent.com/observingClouds/0b7aae90f77e7906346344aa1fb7d070/raw/149eac5934a75573dda58c4a3ca3fea9f17dea0c/a.kml`

    console.log('Loading:',url)

    layer = omnivore[ f ]( url ).addTo( map )

    switch(f) {
      case 'wkt': map.setView([26,26],4); break;
      case 'csv': map.setView([50,14],4); break;
      case 'gpx': map.setView([44.9,6.05],11); break;
      case 'kml': map.setView([11,-52],7); break;
      case 'polyline': map.setView([40,-121],6); break;
      case 'topojson': map.setView([51,52],3); break;
    }
	}

	const removeFile = () => {
		if(layer) {
			map.removeLayer(layer)
			layer = null
		}
	}

	</script>
</plugin>
